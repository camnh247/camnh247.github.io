<html>
  <head>
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Test Family Tree</title>
    <link rel="stylesheet" href="styles.css" />

    <script>
      const test = [
        {
          primaryPerson: {
            name: "Nguyễn Ngọc Giản",
            birthPlace: "Quê quán",
            birthYear: "NS",
            deathYear: "NM",
            gender: 0,
          },
          secondaryPerson: {
            name: "Phạm Thị Nhuế",
            birthPlace: "Quê quán",
            birthYear: "NS",
            deathYear: "NM",
            gender: 1,
          },
          children: [
            {
              primaryPerson: {
                name: "Nguyễn Ngọc Cứ",
                birthPlace: "Quê quán",
                birthYear: "NS",
                deathYear: "NM",
                gender: 0,
              },
              secondaryPerson: {
                name: "Huỳnh Thị Chiết",
                birthPlace: "Quê quán",
                birthYear: "NS",
                deathYear: "NM",
                gender: 1,
              },
              children: [
                {
                  primaryPerson: {
                    name: "Nguyễn Ngọc Mính",
                    birthPlace: "Quê quán",
                    birthYear: "NS",
                    deathYear: "NM",
                    gender: 0,
                  },
                  secondaryPerson: {
                    name: "Lê Thị Hữu",
                    birthPlace: "Quê quán",
                    birthYear: "NS",
                    deathYear: "NM",
                    gender: 1,
                  },
                  children: [
                    {
                      primaryPerson: {
                        name: "Lê Thị Lợi",
                        birthPlace: "Quê quán",
                        birthYear: "NS",
                        deathYear: "NM",
                        gender: 1,
                      },
                      secondaryPerson: {
                        name: "Nguyễn Ngọc Hài",
                        birthPlace: "Quê quán",
                        birthYear: "NS",
                        deathYear: "NM",
                        gender: 0,
                      },
                      thirdPerson: {
                        name: "Châu Thị Thường",
                        birthPlace: "Quê quán",
                        birthYear: "NS",
                        deathYear: "NM",
                        gender: 1,
                      },
                      children: [
                        {
                          primaryPerson: {
                            name: "Nguyễn Ngọc Vịnh",
                            birthPlace: "Núi Thành, QN",
                            birthYear: "NS",
                            deathYear: "NM",
                            gender: 0,
                          },
                          secondaryPerson: {
                            name: "Phạm Thị Huề",
                            birthPlace: "Quê quán",
                            birthYear: "NS",
                            deathYear: "NM",
                            gender: 1,
                          },
                        },
                        {
                          primaryPerson: {
                            name: "Nguyễn Ngọc Tý (Sò)",
                            birthPlace: "Núi Thành, QN",
                            birthYear: "NS",
                            deathYear: "NM",
                            gender: 0,
                          },
                          secondaryPerson: {
                            name: "Chưa xác đinh",
                            birthPlace: "Quê quán",
                            birthYear: "NS",
                            deathYear: "NM",
                            gender: 1,
                          },
                        },
                        {
                          primaryPerson: {
                            name: "Nguyễn Ngọc Lãng (Dề)",
                            birthPlace: "Núi Thành, QN",
                            birthYear: "NS",
                            deathYear: "NM",
                            gender: 0,
                          },
                          secondaryPerson: {
                            name: "Chưa xác đinh",
                            birthPlace: "Quê quán",
                            birthYear: "NS",
                            deathYear: "NM",
                            gender: 1,
                          },
                        },
                        {
                          primaryPerson: {
                            name: "Lê Thị Tân",
                            birthPlace: "Núi Thành, QN",
                            birthYear: "NS",
                            deathYear: "NM",
                            gender: 1,
                          },
                          secondaryPerson: {
                            name: "Nguyễn Ngọc Diệc",
                            birthPlace: "Núi Thành, QN",
                            birthYear: "NS",
                            deathYear: "NM",
                            gender: 0,
                          },
                          children: [
                            {
                              primaryPerson: {
                                name: "Nguyễn Yết",
                                birthPlace: "Núi Thành, QN",
                                birthYear: "NS",
                                deathYear: "NM",
                                gender: 0,
                              },
                              secondaryPerson: {
                                name: "Võ Thị Tiền",
                                birthPlace: "Núi Thành, QN",
                                birthYear: "NS",
                                deathYear: "NM",
                                gender: 1,
                              },
                            },
                          ],
                        },
                        {
                          primaryPerson: {
                            name: "Nguyễn Ngọc Diệc",
                            birthPlace: "Núi Thành, QN",
                            birthYear: "NS",
                            deathYear: "NM",
                            gender: 0,
                          },
                          secondaryPerson: {
                            name: "Ung Thị Thực",
                            birthPlace: "Quê quán",
                            birthYear: "NS",
                            deathYear: "NM",
                            gender: 1,
                          },
                        },
                        {
                          primaryPerson: {
                            name: "Nguyễn Ngọc Mỹ",
                            birthPlace: "Núi Thành, QN",
                            birthYear: "NS",
                            deathYear: "NM",
                            gender: 0,
                          },
                          secondaryPerson: {
                            name: "Chưa xác đinh",
                            birthPlace: "Quê quán",
                            birthYear: "NS",
                            deathYear: "NM",
                            gender: 1,
                          },
                        },
                      ],
                    },
                  ],
                },
              ],
            },
          ],
        },
      ];

      (() => {
        currentPointer = test;

        const isCouple = (couple) =>
          couple.secondaryPerson && couple.secondaryPerson.name;

        const isThirdPerson = (couple) =>
          couple.thirdPerson && couple.thirdPerson.name;

        const genderClass = (person) =>
          person.gender === 0 ? "Male" : "Female";

        const description = (person) =>
          `${person.name} \n ${person.birthPlace} \n ${person.birthYear} - ${person.deathYear}`;

        const createNode = (couple) => {
          const ul = document.createElement("ul");
          const li = document.createElement("li");
          const div = document.createElement("div");
          const ulChildren = document.createElement("ul");

          // Primary person
          const primaryPerson = document.createElement("span");
          primaryPerson.innerHTML = description(couple.primaryPerson);
          primaryPerson.classList.add(genderClass(couple.primaryPerson));
          div.appendChild(primaryPerson);

          // Check couple
          if (isCouple(couple)) {
            li.classList.add("couple");

            const secondaryPerson = document.createElement("span");
            secondaryPerson.innerHTML = description(couple.secondaryPerson);
            secondaryPerson.classList.add(genderClass(couple.secondaryPerson));
            div.appendChild(secondaryPerson);
          }

          // Check third person
          if (isThirdPerson(couple)) {
            const thirdPerson = document.createElement("span");
            thirdPerson.innerHTML = description(couple.thirdPerson);
            thirdPerson.classList.add(genderClass(couple.thirdPerson));
            div.appendChild(thirdPerson);
          }

          li.appendChild(div);

          return { ul, li, div, ulChildren };
        };

        const recursive = (container, couple) => {
          const { ul, li, div, ulChildren } = createNode(couple);

          // Check children
          if (couple.children && couple.children.length) {
            couple.children.forEach((element) => {
              recursive(ulChildren, element);
            });
            li.appendChild(ulChildren);
          }

          container.appendChild(li);
        };

        setTimeout(() => {
          const familyTreeDiv = document.getElementById("FamilyTreeDiv");
          const ul = document.createElement("ul");

          test.forEach((element) => {
            const li = document.createElement("li");
            recursive(li, element);
            ul.appendChild(li);
          });

          familyTreeDiv.append(ul);
        }, 1);
      })();
    </script>
  </head>

  <body>
    <div class="tree" id="FamilyTreeDiv"></div>
  </body>
</html>
